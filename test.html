<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parse Character Upload</title>
  </head>
  <body>
    <input type="file" id="fileInput" />
    <input type="text" id="nameInput" placeholder="Enter character name" />
    <button onclick="uploadCharacter()">Upload Character</button>
    <ul id="characterList"></ul>

    <script src="https://unpkg.com/parse/dist/parse.js"></script>
    <!-- <script src="app.js"></script> -->
  </body>
</html>

<script>
  // Initialize Parse
  Parse.initialize(
    "fJdH7sVkUDqc6DKnTP8pn74MAgJtDMH8GZaxIXP3",
    "Jolo5FvOIS48u8aRHkC2alcI3mOVv9JUFswssZ2R"
  );
  Parse.serverURL = "https://parseapi.back4app.com/";

  // Define Parse object for Characters
  const Characters = Parse.Object.extend("Characters");

  // Function to upload a character
  function uploadCharacter() {
    const fileInput = document.getElementById("fileInput");
    const nameInput = document.getElementById("nameInput");
    const file = fileInput.files[0];

    if (file && nameInput.value.trim() !== "") {
      const parseFile = new Parse.File("profile.jpg", file);

      parseFile
        .save()
        .then(() => {
          const character = new Characters();
          character.set("Character", nameInput.value.trim());
          character.set("Profile", parseFile);
          return character.save();
        })
        .then(() => {
          console.log("Character uploaded successfully!");
          fetchCharacters();
        })
        .catch((error) => {
          console.error("Error uploading character:", error);
        });
    } else {
      console.error("Please select a file and enter a character name");
    }
  }

  // Function to fetch and display characters
  function fetchCharacters() {
    const query = new Parse.Query(Characters);

    query
      .find()
      .then((characters) => {
        const characterList = document.getElementById("characterList");
        characterList.innerHTML = "";

        characters.forEach((character) => {
          const imageUrl = character.get("Profile").url();
          const name = character.get("Character");
          const listItem = document.createElement("li");
          const img = document.createElement("img");
          img.src = imageUrl;
          img.width = 100;
          const textNode = document.createTextNode(`Character: ${name}`);
          listItem.appendChild(img);
          listItem.appendChild(textNode);
          characterList.appendChild(listItem);
        });
      })
      .catch((error) => {
        console.error("Error fetching characters:", error);
        alert("Error fetching data. Please try again.");
      });
  }
</script>
